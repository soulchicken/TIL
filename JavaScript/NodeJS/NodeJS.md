# Node JS

## 노드

Chrome V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임

→ 노드는 서버가 아니라 서버 역할도 할 수 있는 런타임

### 런타임

- 특정 언어로 만든 프로그램들을 실행할 수 있게 해주는 가상 머신의 상태
- 노드 외의 런타임 : 크롬, 엣지같은 웹 브라우저

### 내부 구조

- C / C++ 로 구현되어 있음
- V8 엔진 : 오픈 소스 자바스크립트 엔진
- libuv: 노드의 특성인 이벤트 기반, 논블로킹 I/O 모델을 구현한 라이브러리
  - 싱글스레드인데다가 비동기인 자바스크립

## 이벤트 기반

- 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식
  - 이벤트 : 클릭, 네트워크 요청, 타이머 등
  - 이벤트 리스너 : 이벤트를 등록하는 함수
  - 콜백 함수 : 이벤트가 발생했을 때 실행될 함수

### 논블로킹 I/O

논블로킹 : 오래 걸리는 함수를 백그라운드로 보내서 다음 코드가 먼저 실행되게 하고, 나중에 오래 걸리는 함수를 실행

- 논 블로킹 방식 하에서 일부 코드는 백그라운드에서 병렬로 실행됨
- 일부 코드 : I/O 작업(파일 시스템 접근, 네트워크 요청), 압축, 암호화 등
- 나머지 코드는 블로킹 방식으로 실행됨

→ 블로킹 : 코드가 순서대로 실행

논블로킹 : 순서대로 진행되지 **않을 수도 있다.**

### 프로세스 vs 스레드

- **프로세스** : 운영체제에서 할당하는 작업의 단위, 프로세스 간 자원 공유 X
- **스레드** : 프로세스 내에서 실행되는 작업의 단위, 부모 프로세스 자원 공유

→ 노드 프로세스는 멀티 스레드이지만 직접 다룰 수 있는 스레드는 하나이기 때문에 **싱글 스레드**라고 표현

⇒ 노드는 주로 멀티 스레드 대신 **멀티 프로세스 활용**

(노드는 14버전부터 멀티 스레드 사용 가능)

### 싱글 스레드

- 싱글 스레드라 주어진 일을 하나 밖에 처리하지 못함
  → 블로킹이 발생하는 경우 나머지 작업은 모두 대기해야함
- 싱글 스레드 모델은 에러를 처리하지 못하는 경우 멈춤
  → 그러나 프로그래밍 난이도는 쉽고, CPU, 메모리 작업 적게 사용함
  ⇒ 논 블로킹 모델을 채택하여 일부 코드(I/O)를 백그라운드(다른 프로세스)에서 실행 가능
  - 요청을 먼저 받고, 완료될 때 응답
  - I/O와 관련 코드가 아닌 경우 싱글 스레드, 블로킹 모델과 같아짐

### 멀티 스레드

- 노드 14버전부터 멀티 스레드를 사용할 수 있도록 worker_threads 모듈 도입
- CPU를 많이 사용하는 작업인 경우에 활용
